<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Red Bull Ã‡ark</title>

<!-- ðŸ”´ MOBÄ°LÄ°N KALBÄ° -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: Arial, sans-serif;
  min-height: 100svh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle at top, #1e3c72 0%, #0f2027 40%, #000 100%);
  overflow: hidden;
}

.container {
  width: 100%;
  max-width: 420px;
  padding: 16px;
  text-align: center;
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(6px);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.4);
}

h2 {
  color: #fff;
  margin: 8px 0 16px;
}

canvas {
  width: 90vw;
  max-width: 340px;
  aspect-ratio: 1 / 1;
  border-radius: 50%;
  margin: auto;
  display: block;
}

button {
  width: 100%;
  margin-top: 16px;
  padding: 14px;
  font-size: 18px;
  font-weight: bold;
  border-radius: 10px;
  border: none;
  background: #ff9800;
  color: #fff;
}

button.disabled {
  background: #555;
  opacity: 0.7;
}

#result {
  margin-top: 16px;
  font-size: 22px;
  font-weight: bold;
  color: #fff;
}

.note {
  display: block;
  font-size: 14px;
  opacity: 0.8;
  margin-top: 6px;
}
</style>
</head>

<body>
<div class="container">
  <h2>âš¡ RED BULL Ã‡ARK âš¡</h2>
  <canvas id="wheel"></canvas>
  <button id="spinBtn">Ã‡EVÄ°R</button>
  <div id="result"></div>
</div>

<script>
"use strict";

const DAILY_KEY = "rb_spin_date";
const CODE_KEY = "rb_reward_code";
const options = ["%20", "%10", "%30", "1+1 RED BULL", "%20", "%5"];

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
let angle = 0;

/* ðŸ”§ MOBÄ°L CANVAS SENKRONU */
function resizeCanvas() {
  const size = Math.min(window.innerWidth * 0.9, 340);
  canvas.width = size;
  canvas.height = size;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

function todayKey() {
  const now = new Date();
  const tr = new Date(now.toLocaleString("en-US", { timeZone: "Europe/Istanbul" }));
  tr.setHours(0,0,0,0);
  return tr.getTime();
}

function checkDailySpin() {
  const btn = document.getElementById("spinBtn");
  if (Number(localStorage.getItem(DAILY_KEY)) === todayKey()) {
    btn.disabled = true;
    btn.classList.add("disabled");
    btn.innerText = "BUGÃœN KULLANILDI";
  }
}

function drawWheel() {
  const center = canvas.width / 2;
  const radius = center;
  const slice = (2 * Math.PI) / options.length;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  options.forEach((text, i) => {
    ctx.beginPath();
    ctx.moveTo(center, center);
    ctx.arc(center, center, radius, slice * i + angle, slice * (i + 1) + angle);

    ctx.fillStyle =
      text === "%5" ? "#e53935" :
      text === "%10" ? "#1e88e5" :
      text === "%30" ? "#8e24aa" :
      text === "1+1 RED BULL" ? "#fdd835" :
      "#43a047";

    ctx.fill();

    ctx.save();
    ctx.translate(center, center);
    ctx.rotate(slice * i + slice / 2 + angle);
    ctx.fillStyle = "#333";
    ctx.font = "bold 16px Arial";
    ctx.textAlign = "center";
    ctx.fillText(text, radius * 0.6, 0);
    ctx.restore();
  });
}

function spin() {
  if (Number(localStorage.getItem(DAILY_KEY)) === todayKey()) return;

  const resultEl = document.getElementById("result");
  resultEl.innerHTML = "";

  const weighted = [
    { label: "%5", w: 5 },
    { label: "%10", w: 25 },
    { label: "%20", w: 20 },
    { label: "%20", w: 20 },
    { label: "%30", w: 15 },
    { label: "1+1 RED BULL", w: 15 }
  ];

  let r = Math.random() * 100;
  let selected = weighted[0].label;
  for (const o of weighted) {
    if (r < o.w) { selected = o.label; break; }
    r -= o.w;
  }

  const targetIndex = options.findIndex(o => o === selected);
  const slice = (2 * Math.PI) / options.length;
  const spinAngle = 5 * 2 * Math.PI + (options.length - targetIndex) * slice;

  let start = null;
  function animate(ts) {
    if (!start) start = ts;
    const t = Math.min((ts - start) / 3000, 1);
    angle = spinAngle * (1 - Math.pow(1 - t, 3));
    drawWheel();

    if (t < 1) requestAnimationFrame(animate);
    else {
      localStorage.setItem(DAILY_KEY, todayKey());
      checkDailySpin();

      let code = sessionStorage.getItem(CODE_KEY);
      if (!code) {
        code = Math.floor(100000 + Math.random() * 900000);
        sessionStorage.setItem(CODE_KEY, code);
      }

      resultEl.innerHTML = KAZANDINIZ: ${selected}<br>KOD: ${code}<span class="note">Kasiyere gÃ¶steriniz</span>;
    }
  }
  requestAnimationFrame(animate);
}

document.getElementById("spinBtn").addEventListener("click", spin);
checkDailySpin();
drawWheel();
</script>
</body>
</html>
